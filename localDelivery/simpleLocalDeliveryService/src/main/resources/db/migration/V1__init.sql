CREATE TABLE IF NOT EXISTS warehouses (
    warehouse_id UUID PRIMARY KEY,
    name TEXT NOT NULL,
    latitude DOUBLE PRECISION NOT NULL,
    longitude DOUBLE PRECISION NOT NULL
);

CREATE TABLE IF NOT EXISTS items (
    item_id UUID PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS inventory (
    warehouse_id UUID NOT NULL REFERENCES warehouses(warehouse_id),
    item_id UUID NOT NULL REFERENCES items(item_id),
    available_qty INT NOT NULL,
    reserved_qty INT NOT NULL,
    PRIMARY KEY (warehouse_id, item_id)
);

CREATE TABLE IF NOT EXISTS customers (
    customer_id UUID PRIMARY KEY,
    name TEXT NOT NULL,
    latitude DOUBLE PRECISION NOT NULL,
    longitude DOUBLE PRECISION NOT NULL
);

CREATE TABLE IF NOT EXISTS orders (
    order_id UUID PRIMARY KEY,
    customer_id UUID NOT NULL REFERENCES customers(customer_id),
    status TEXT NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE IF NOT EXISTS order_lines (
    order_id UUID NOT NULL REFERENCES orders(order_id),
    item_id UUID NOT NULL REFERENCES items(item_id),
    warehouse_id UUID NOT NULL REFERENCES warehouses(warehouse_id),
    qty INT NOT NULL,
    PRIMARY KEY (order_id, item_id, warehouse_id)
);

-- Demo seed data
INSERT INTO warehouses(warehouse_id, name, latitude, longitude) VALUES
    ('00000000-0000-0000-0000-000000000001', 'Downtown Warehouse', 40.7128, -74.0060),
    ('00000000-0000-0000-0000-000000000002', 'Midtown Warehouse', 40.7580, -73.9855),
    ('00000000-0000-0000-0000-000000000003', 'Brooklyn Warehouse', 40.6782, -73.9442)
ON CONFLICT DO NOTHING;

INSERT INTO items(item_id, name) VALUES
    ('10000000-0000-0000-0000-000000000001', 'Milk'),
    ('10000000-0000-0000-0000-000000000002', 'Bread'),
    ('10000000-0000-0000-0000-000000000003', 'Eggs'),
    ('10000000-0000-0000-0000-000000000004', 'Cheese')
ON CONFLICT DO NOTHING;

INSERT INTO inventory(warehouse_id, item_id, available_qty, reserved_qty) VALUES
    ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 50, 0),
    ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', 100, 0),
    ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', 75, 0),

    ('00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 30, 0),
    ('00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000004', 40, 0),

    ('00000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000002', 80, 0),
    ('00000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000003', 90, 0)
ON CONFLICT DO NOTHING;

INSERT INTO customers(customer_id, name, latitude, longitude) VALUES
    ('20000000-0000-0000-0000-000000000001', 'Alice', 40.730610, -73.935242),
    ('20000000-0000-0000-0000-000000000002', 'Bob', 40.650002, -73.949997)
ON CONFLICT DO NOTHING;
